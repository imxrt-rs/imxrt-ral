<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Write to a RWRegister or UnsafeRWRegister."><meta name="keywords" content="rust, rustlang, rust-lang, write_reg"><title>write_reg in imxrt_ral - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../imxrt_ral/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><div class="sidebar-elems"><p class="location"><a href="index.html">imxrt_ral</a></p><div id="sidebar-vars" data-name="write_reg" data-ty="macro" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Macro <a href="index.html">imxrt_ral</a>::<wbr><a class="macro" href="">write_reg</a><button id="copy-path" onclick="copy_path(this)">⎘</button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/imxrt_ral/register.rs.html#254-268" title="goto source code">[src]</a></span></h1><div class="docblock type-decl"><div class="example-wrap"><pre class="rust macro">
<span class="macro">macro_rules!</span> <span class="ident">write_reg</span> {
    ( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">periph</span>:<span class="ident">path</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">instance</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">reg</span>:<span class="ident">ident</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">field</span>:<span class="ident">ident</span> : <span class="macro-nonterminal">$</span><span class="macro-nonterminal">value</span>:<span class="ident">expr</span> ),<span class="op">+</span> ) <span class="op">=</span><span class="op">&gt;</span> { ... };
    ( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">periph</span>:<span class="ident">path</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">instance</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">reg</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">value</span>:<span class="ident">expr</span> ) <span class="op">=</span><span class="op">&gt;</span> { ... };
}</pre></div>
</div><div class="docblock"><p>Write to a RWRegister or UnsafeRWRegister.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// Safely acquire the peripheral instance (will panic if already acquired)</span>
<span class="kw">let</span> <span class="ident">gpio</span> <span class="op">=</span> <span class="ident">imxrt_ral::gpio::GPIO1::take</span>().<span class="ident">unwrap</span>();

<span class="comment">// Write some value to the register.</span>
<span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="number">0b11</span><span class="op">&lt;</span><span class="op">&lt;</span><span class="number">6</span>);

<span class="comment">// Write values to specific fields. Unspecified fields are written to 0.</span>
<span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>);

<span class="comment">// Unsafe access without requiring you to first `take()` the instance</span>
<span class="kw">unsafe</span> { <span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">GPIO1</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>) };</pre></div>
<h1 id="usage" class="section-header"><a href="#usage">Usage</a></h1>
<p>Like <code>modify_reg!</code>, this macro can be used in two ways, either with a single value to write to
the whole register, or with multiple fields each with their own value.</p>
<p>In both cases, the first arguments are:</p>
<ul>
<li>the path to the peripheral module: <code>imxrt_ral::gpio</code>,</li>
<li>a reference to the instance of that peripheral: ‘gpio’ (anything which dereferences to
<code>RegisterBlock</code>, such as <code>Instance</code>, <code>&amp;Instance</code>, <code>&amp;RegisterBlock</code>, or
<code>*const RegisterBlock</code>),</li>
<li>the register you wish you access: <code>ICR1</code> (a field on the <code>RegisterBlock</code>).</li>
</ul>
<p>In the single-value usage, the final argument is just the value to write:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// Turn on the fourth pin (and turn everything else off).</span>
<span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">gpio</span>, <span class="ident">DR</span>, <span class="number">1</span><span class="op">&lt;</span><span class="op">&lt;</span><span class="number">3</span>);</pre></div>
<p>Otherwise, the remaining arguments are each <code>Field: Value</code> pairs:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// Set ICR3 and ICR4, and everything else to 0.</span>
<span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="number">0b01</span>, <span class="ident">ICR4</span>: <span class="number">0b11</span>);</pre></div>
<p>For fields with annotated values, you can also specify a named value:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// As above, but with named values.</span>
<span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>);</pre></div>
<p>This macro expands to calling <code>(*$instance).$register.write(value)</code>,
where in the second usage, the value is computed as the bitwise OR of
each field value, which are masked and shifted appropriately for the given field.
The named values are brought into scope by <code>use $peripheral::$register::$field::*</code> for
each field. The same constants could just be specified manually:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// As above, but being explicit about named values.</span>
<span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">imxrt_ral::gpio::ICR1::ICR3::RW::FALLING_EDGE</span>,
                                         <span class="ident">ICR4</span>: <span class="ident">imxrt_ral::gpio::ICR1::ICR4::RW::LOW_LEVEL</span>);</pre></div>
<p>The fully expanded form is equivalent to:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// As above, but expanded.</span>
(<span class="kw-2">*</span><span class="ident">gpio</span>).<span class="ident">ICR1</span>.<span class="ident">write</span>(
    ((<span class="ident">imxrt_ral::gpio::ICR1::ICR3::RW::FALLING_EDGE</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="ident">imxrt_ral::gpio::ICR1::ICR3::offset</span>)
     <span class="op">&amp;</span> <span class="ident">imxrt_ral::gpio::ICR1::ICR3::mask</span>)
    <span class="op">|</span>
    ((<span class="ident">imxrt_ral::gpio::ICR1::ICR4::RW::LOW_LEVEL</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="ident">imxrt_ral::gpio::ICR1::ICR4::offset</span>)
     <span class="op">&amp;</span> <span class="ident">imxrt_ral::gpio::ICR1::ICR4::mask</span>)
);</pre></div>
<h1 id="safety" class="section-header"><a href="#safety">Safety</a></h1>
<p>This macro will require an unsafe function or block when used with an UnsafeRWRegister,
but not if used with RWRegister.</p>
<p>When run in an unsafe context, peripheral instances are directly accessible without requiring
having called <code>take()</code> beforehand:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">unsafe</span> { <span class="macro">write_reg!</span>(<span class="ident">imxrt_ral::gpio</span>, <span class="ident">GPIO1</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>) };</pre></div>
<p>This works because <code>GPIO1</code> is a <code>*const RegisterBlock</code> in the <code>imxrt_ral::gpio</code> module;
and the macro brings such constants into scope and then dereferences the provided reference.</p>
</div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="imxrt_ral" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script></body></html>