<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Write to a RWRegister or UnsafeRWRegister."><meta name="keywords" content="rust, rustlang, rust-lang, write_reg"><title>write_reg in imxrt_ral - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../imxrt_ral/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../imxrt_ral/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><div class="sidebar-elems"><h2 class="location"><a href="index.html">In imxrt_ral</a></h2><div id="sidebar-vars" data-name="write_reg" data-ty="macro" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../imxrt_ral/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Macro <a href="index.html">imxrt_ral</a>::<wbr><a class="macro" href="#">write_reg</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><div class="example-wrap"><pre class="rust macro"><code><span class="macro">macro_rules!</span> <span class="ident">write_reg</span> {
    ( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">periph</span>:<span class="ident">path</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">instance</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">reg</span>:<span class="ident">ident</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">field</span>:<span class="ident">ident</span> : <span class="macro-nonterminal">$</span><span class="macro-nonterminal">value</span>:<span class="ident">expr</span> ),<span class="op">+</span> ) =&gt; { ... };
    ( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">periph</span>:<span class="ident">path</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">instance</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">reg</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">value</span>:<span class="ident">expr</span> ) =&gt; { ... };
}</code></pre></div>
</div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Write to a RWRegister or UnsafeRWRegister.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Safely acquire the peripheral instance (will panic if already acquired)</span>
<span class="kw">let</span> <span class="ident">gpioa</span> <span class="op">=</span> <span class="ident">stm32ral::gpio::GPIOA::take</span>().<span class="ident">unwrap</span>();

<span class="comment">// Write some value to the register.</span>
<span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">gpioa</span>, <span class="ident">ODR</span>, <span class="number">1</span><span class="op">&lt;</span><span class="op">&lt;</span><span class="number">3</span>);

<span class="comment">// Write values to specific fields. Unspecified fields are written to 0.</span>
<span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">gpioa</span>, <span class="ident">MODER</span>, <span class="ident">MODER3</span>: <span class="ident">Output</span>, <span class="ident">MODER4</span>: <span class="ident">Analog</span>);

<span class="comment">// Unsafe access without requiring you to first `take()` the instance</span>
<span class="kw">unsafe</span> { <span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">GPIOA</span>, <span class="ident">MODER</span>, <span class="ident">MODER3</span>: <span class="ident">Output</span>, <span class="ident">MODER4</span>: <span class="ident">Analog</span>) };</code></pre></div>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>Like <code>modify_reg!</code>, this macro can be used in two ways, either with a single value to write to
the whole register, or with multiple fields each with their own value.</p>
<p>In both cases, the first arguments are:</p>
<ul>
<li>the path to the peripheral module: <code>stm32ral::gpio</code>,</li>
<li>a reference to the instance of that peripheral: ‘gpioa’ (anything which dereferences to
<code>RegisterBlock</code>, such as <code>Instance</code>, <code>&amp;Instance</code>, <code>&amp;RegisterBlock</code>, or
<code>*const RegisterBlock</code>),</li>
<li>the register you wish you access: <code>MODER</code> (a field on the <code>RegisterBlock</code>).</li>
</ul>
<p>In the single-value usage, the final argument is just the value to write:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Turn on PA3 (and turn everything else off).</span>
<span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">gpioa</span>, <span class="ident">ODR</span>, <span class="number">1</span><span class="op">&lt;</span><span class="op">&lt;</span><span class="number">3</span>);</code></pre></div>
<p>Otherwise, the remaining arguments are each <code>Field: Value</code> pairs:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Set PA3 to Output, PA4 to Analog, and everything else to 0 (which is Input).</span>
<span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">gpioa</span>, <span class="ident">MODER</span>, <span class="ident">MODER3</span>: <span class="number">0b01</span>, <span class="ident">MODER4</span>: <span class="number">0b11</span>);</code></pre></div>
<p>For fields with annotated values, you can also specify a named value:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// As above, but with named values.</span>
<span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">gpioa</span>, <span class="ident">MODER</span>, <span class="ident">MODER3</span>: <span class="ident">Output</span>, <span class="ident">MODER4</span>: <span class="ident">Analog</span>);</code></pre></div>
<p>This macro expands to calling <code>(*$instance).$register.write(value)</code>,
where in the second usage, the value is computed as the bitwise OR of
each field value, which are masked and shifted appropriately for the given field.
The named values are brought into scope by <code>use $peripheral::$register::$field::*</code> for
each field. The same constants could just be specified manually:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// As above, but being explicit about named values.</span>
<span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">gpioa</span>, <span class="ident">MODER</span>, <span class="ident">MODER3</span>: <span class="ident">stm32ral::gpio::MODER::MODER3::RW::Output</span>,
                                         <span class="ident">MODER4</span>: <span class="ident">stm32ral::gpio::MODER::MODER4::RW::Analog</span>);</code></pre></div>
<p>The fully expanded form is equivalent to:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// As above, but expanded.</span>
(<span class="kw-2">*</span><span class="ident">gpioa</span>).<span class="ident">MODER</span>.<span class="ident">write</span>(
    ((<span class="ident">stm32ral::gpio::MODER::MODER3::RW::Output</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="ident">stm32ral::gpio::MODER::MODER3::offset</span>)
     <span class="op">&amp;</span> <span class="ident">stm32ral::gpio::MODER::MODER3::mask</span>)
    <span class="op">|</span>
    ((<span class="ident">stm32ral::gpio::MODER::MODER4::RW::Analog</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="ident">stm32ral::gpio::MODER::MODER4::offset</span>)
     <span class="op">&amp;</span> <span class="ident">stm32ral::gpio::MODER::MODER4::mask</span>)
);</code></pre></div>
<h2 id="safety"><a href="#safety">Safety</a></h2>
<p>This macro will require an unsafe function or block when used with an UnsafeRWRegister,
but not if used with RWRegister.</p>
<p>When run in an unsafe context, peripheral instances are directly accessible without requiring
having called <code>take()</code> beforehand:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">unsafe</span> { <span class="macro">write_reg!</span>(<span class="ident">stm32ral::gpio</span>, <span class="ident">GPIOA</span>, <span class="ident">MODER</span>, <span class="ident">MODER3</span>: <span class="ident">Output</span>, <span class="ident">MODER4</span>: <span class="ident">Analog</span>) };</code></pre></div>
<p>This works because <code>GPIOA</code> is a <code>*const RegisterBlock</code> in the <code>stm32ral::gpio</code> module;
and the macro brings such constants into scope and then dereferences the provided reference.</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="imxrt_ral" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0 (a8314ef7d 2022-06-27)" ></div>
</body></html>