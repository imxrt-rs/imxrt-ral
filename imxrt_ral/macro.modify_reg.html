<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `modify_reg` macro in crate `imxrt_ral`."><meta name="keywords" content="rust, rustlang, rust-lang, modify_reg"><title>imxrt_ral::modify_reg - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc macro"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../imxrt_ral/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><div class="sidebar-elems"><p class="location"><a href="index.html">imxrt_ral</a></p><script>window.sidebarCurrent = {name: "modify_reg", ty: "macro", relpath: ""};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/imxrt_ral/register.rs.html#377-391" title="goto source code">[src]</a></span><span class="in-band">Macro <a href="index.html">imxrt_ral</a>::<wbr><a class="macro" href="">modify_reg</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><div class="example-wrap"><pre class="rust macro">
<span class="macro">macro_rules</span><span class="macro">!</span> <span class="ident">modify_reg</span> {
    ( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">periph</span>:<span class="ident">path</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">instance</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">reg</span>:<span class="ident">ident</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">field</span>:<span class="ident">ident</span> : <span class="macro-nonterminal">$</span><span class="macro-nonterminal">value</span>:<span class="ident">expr</span> ),<span class="op">+</span> ) <span class="op">=</span><span class="op">&gt;</span> { ... };
    ( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">periph</span>:<span class="ident">path</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">instance</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">reg</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="kw">fn</span>:<span class="macro-nonterminal">expr</span> ) <span class="op">=</span><span class="op">&gt;</span> { ... };
}</pre></div>
</div><div class="docblock"><p>Modify a RWRegister or UnsafeRWRegister.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// Safely acquire the peripheral instance (will panic if already acquired)</span>
<span class="kw">let</span> <span class="ident">gpio</span> <span class="op">=</span> <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">GPIO1</span>::<span class="ident">take</span>().<span class="ident">unwrap</span>();

<span class="comment">// Update the register to ensure bit 3 is set.</span>
<span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">gpio</span>, <span class="ident">DR</span>, <span class="op">|</span><span class="ident">reg</span><span class="op">|</span> <span class="ident">reg</span> <span class="op">|</span> (<span class="number">1</span><span class="op">&lt;</span><span class="op">&lt;</span><span class="number">3</span>));

<span class="comment">// Write values to specific fields. Unspecified fields are left unchanged.</span>
<span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>);

<span class="comment">// Unsafe access without requiring you to first `take()` the instance</span>
<span class="kw">unsafe</span> { <span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">GPIO1</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>) };</pre></div>
<h1 id="usage" class="section-header"><a href="#usage">Usage</a></h1>
<p>Like <code>write_reg!</code>, this macro can be used in two ways, either with a modification of the entire
register, or by specifying which fields to change and what value to change them to.</p>
<p>In both cases, the first arguments are:</p>
<ul>
<li>the path to the peripheral module: <code>imxrt_ral::gpio</code>,</li>
<li>a reference to the instance of that peripheral: 'gpio' (anything which dereferences to
<code>RegisterBlock</code>, such as <code>Instance</code>, <code>&amp;Instance</code>, <code>&amp;RegisterBlock</code>, or
<code>*const RegisterBlock</code>),</li>
<li>the register you wish you access: <code>ICR1</code> (a field on the <code>RegisterBlock</code>).</li>
</ul>
<p>In the whole-register usage, the final argument is a closure that accepts the current value
of the register and returns the new value to write:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// Set the third bit without touching any other bits</span>
<span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">gpio</span>, <span class="ident">DR</span>, <span class="op">|</span><span class="ident">reg</span><span class="op">|</span> <span class="ident">reg</span> <span class="op">|</span> (<span class="number">1</span><span class="op">&lt;</span><span class="op">&lt;</span><span class="number">3</span>));</pre></div>
<p>Otherwise, the remaining arguments are <code>Field: Value</code> pairs:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// Set ICR3 and ICR4, and leave everything else unchanged.</span>
<span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="number">0b01</span>, <span class="ident">ICR4</span>: <span class="number">0b11</span>);</pre></div>
<p>For fields with annotated values, you can also specify a named value:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// As above, but with named values.</span>
<span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>);</pre></div>
<p>This macro expands to calling <code>(*instance).register.write(value)</code>.
When called with a closure, <code>(*instance).register.read()</code> is called, the result
passed in to the closure, and the return value of the closure is used for <code>value</code>.
When called with <code>Field: Value</code> arguments, the current value is read and then masked
according to the specified fields, and then ORd with the OR of each field value,
each masked and shifted appropriately for the field. The named values are brought into scope
by <code>use peripheral::register::field::*</code> for each field. The same constants could just be
specified manually:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// As above, but being explicit about named values.</span>
<span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">gpio</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR3</span>::<span class="ident">RW</span>::<span class="ident">FALLING_EDGE</span>,
                                          <span class="ident">ICR4</span>: <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR4</span>::<span class="ident">RW</span>::<span class="ident">LOW_LEVEL</span>);</pre></div>
<p>The fully expanded form is equivalent to:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="comment">// As above, but expanded.</span>
(<span class="kw-2">*</span><span class="ident">gpio</span>).<span class="ident">ICR1</span>.<span class="ident">write</span>(
    (
        <span class="comment">// First read the current value...</span>
        (<span class="kw-2">*</span><span class="ident">gpio</span>).<span class="ident">ICR1</span>.<span class="ident">read</span>()
        <span class="comment">// Then AND it with an appropriate mask...</span>
        <span class="op">&amp;</span>
        <span class="op">!</span>( <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR3</span>::<span class="ident">mask</span> <span class="op">|</span> <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR4</span>::<span class="ident">mask</span> )
    )
    <span class="comment">// Then OR with each field value.</span>
    <span class="op">|</span>
        ((<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR3</span>::<span class="ident">RW</span>::<span class="ident">FALLING_EDGE</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR3</span>::<span class="ident">offset</span>)
         <span class="op">&amp;</span> <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR3</span>::<span class="ident">mask</span>)
    <span class="op">|</span>
        ((<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR4</span>::<span class="ident">RW</span>::<span class="ident">LOW_LEVEL</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR4</span>::<span class="ident">offset</span>)
         <span class="op">&amp;</span> <span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>::<span class="ident">ICR1</span>::<span class="ident">ICR4</span>::<span class="ident">mask</span>)
);</pre></div>
<h1 id="safety" class="section-header"><a href="#safety">Safety</a></h1>
<p>This macro will require an unsafe function or block when used with an UnsafeRWRegister,
but not if used with RWRegister.</p>
<p>When run in an unsafe context, peripheral instances are directly accessible without requiring
having called <code>take()</code> beforehand:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">unsafe</span> { <span class="macro">modify_reg</span><span class="macro">!</span>(<span class="ident">imxrt_ral</span>::<span class="ident">gpio</span>, <span class="ident">GPIO1</span>, <span class="ident">ICR1</span>, <span class="ident">ICR3</span>: <span class="ident">FALLING_EDGE</span>, <span class="ident">ICR4</span>: <span class="ident">LOW_LEVEL</span>) };</pre></div>
<p>This works because <code>GPIO1</code> is a <code>*const RegisterBlock</code> in the <code>imxrt_ral::gpio</code> module;
and the macro brings such constants into scope and then dereferences the provided reference.</p>
</div></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "imxrt_ral";</script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>